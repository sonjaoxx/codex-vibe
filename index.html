<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Скорость подключения</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="no-js">
    <main class="dashboard">
      <div class="dial">
        <svg class="dial__frame" viewBox="0 0 320 320" aria-hidden="true">
          <defs>
            <linearGradient id="dial-progress-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#ff3355" />
              <stop offset="100%" stop-color="#ff0032" />
            </linearGradient>
          </defs>
          <circle class="dial__ring-track" cx="160" cy="160" r="120" pathLength="100"></circle>
          <circle class="dial__ring-fill" cx="160" cy="160" r="120" pathLength="100"></circle>
          <circle class="dial__ring-center" cx="160" cy="160" r="88"></circle>
        </svg>
        <div class="metrics">
          <div class="metric" data-value="27.18" data-decimals="2" data-duration="1400">
            <div class="metric__title">Входящая</div>
            <div class="metric__value">
              <span class="metric__value-number">0</span>
              <span class="metric__unit">Мбит/с</span>
            </div>
          </div>
          <div class="metric" data-value="30.28" data-decimals="2" data-duration="1200">
            <div class="metric__title">Исходящая</div>
            <div class="metric__value">
              <span class="metric__value-number">0</span>
              <span class="metric__unit">Мбит/с</span>
            </div>
          </div>
          <div class="metric" data-value="32" data-decimals="0" data-duration="1500">
            <div class="metric__title">Задержка</div>
            <div class="metric__value">
              <span class="metric__value-number">0</span>
              <span class="metric__unit">мс</span>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const body = document.body;
        body.classList.remove('no-js');
        const metrics = Array.from(document.querySelectorAll('.metric'));
        const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        const bootDelay = reduceMotion ? 0 : 240;
        const betweenShift = reduceMotion ? 0 : 260;
        const coolDown = reduceMotion ? 0 : 320;
        if (!metrics.length) {
          body.classList.add('is-ready');
          return;
        }

        const wait = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
        const easeOutCubic = (t) => 1 - Math.pow(1 - t, 3);

        const animateValue = (element, target, decimals, duration) => {
          return new Promise((resolve) => {
            const effectiveDuration = reduceMotion ? 0 : duration;
            const start = performance.now();
            const startValue = 0;

            const format = (value) => {
              if (decimals > 0) {
                return value.toFixed(decimals);
              }
              return Math.round(value).toString();
            };

            if (effectiveDuration === 0) {
              element.textContent = format(target);
              resolve();
              return;
            }

            const update = (now) => {
              const progress = Math.min((now - start) / effectiveDuration, 1);
              const eased = easeOutCubic(progress);
              const current = startValue + (target - startValue) * eased;
              element.textContent = format(current);

              if (progress < 1) {
                requestAnimationFrame(update);
              } else {
                element.textContent = format(target);
                resolve();
              }
            };

            requestAnimationFrame(update);
          });
        };

        const startSequence = async () => {
          body.classList.add('is-ready');
          await wait(bootDelay);

          for (const metric of metrics) {
            const valueEl = metric.querySelector('.metric__value-number');
            const target = Number(metric.dataset.value);
            const decimals = Number(metric.dataset.decimals || 0);
            const duration = Number(metric.dataset.duration || 1200);
            metric.classList.add('metric--active');
            await animateValue(valueEl, target, decimals, duration);
            metric.classList.remove('metric--active');
            metric.classList.add('metric--complete');
            await wait(betweenShift);
          }

          await wait(coolDown);
          body.classList.add('is-finished');
        };

        startSequence();
      });
    </script>
  </body>
</html>
